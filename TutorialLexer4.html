<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'Liberation Sans'; font-size:8pt; font-weight:400; font-style:normal;">
<table style="-qt-table-type: root; margin-top:57px; margin-bottom:57px; margin-left:57px; margin-right:57px;">
<tr>
<td style="border: none;">
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:6.95268e-310px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:28pt; font-weight:600;">Tutorial: advanced lexer options</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:6.95268e-310px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:28pt; font-weight:600;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:6.95268e-310px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:18pt; color:#579d1c;">1) Parser states</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:4.66203e-310px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:18pt; color:#579d1c;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:6.95268e-310px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:12pt;">Options in Lexer Properties dialog: parser state - present/absent/set/reset. These 4 options exist for “Parser” tab and for “Rules” tab, so states can be used for parsers, and for range rules.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:6.95268e-310px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:12pt;">Parser state is 32 bit number. It has bits:</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:4.66203e-310px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">bit0 – gives number 1</li>
<li style=" font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:4.66203e-310px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">bit1 – gives number 2</li>
<li style=" font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:4.66203e-310px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">bit2 - gives number 4</li>
<li style=" font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:4.66203e-310px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">bit3 – gives number 8</li>
<li style=" font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:4.66203e-310px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">bit N - gives number 2^N</li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:6.95268e-310px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:12pt;">To pack bits to number, add numbers: bit2 and bit3 – gives number 4+8 = 12.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:6.95268e-310px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:12pt; font-weight:600;">Check state: Present: </span><span style=" font-size:12pt;">- rule will run only if bits from number are set (in parser state). For ex, 12 means that check is: bit2 and bit3 are set. For ex, to check that bit0/bit1/bit2 are set, use number 7 (1+2+4).</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:6.95268e-310px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:12pt; font-weight:600;">Check state: Absent:</span><span style=" font-size:12pt;"> - rule will run only if bits from number are cleared (in parser state). For ex, 12 means that check is: bit2 and bit3 cleared.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:6.95268e-310px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:12pt; font-weight:600;">Modify state: Set:</span><span style=" font-size:12pt;"> – when rule activates, it sets bits (in parser state) from this number. For ex, if you want to set bit3, set option to 8.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:6.95268e-310px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:12pt; font-weight:600;">Modify state: Reset: </span><span style=" font-size:12pt;">- when rule activates, it clears bits (in parser state) from this number. For ex, if you want to clear bit3, set option to 8.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:6.95268e-310px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:12pt;">Real example in lexer LaTeX. It has block rules “math begin”, “math end”. Opening rule runs when bit2 is clear, then sets bit2. Closing rule runs when bit2 is set (by opening rule before) and then it clears bit2 (for next running of opening rule). Some parser rule can check bit2, and this parser rule runs only inside math-block. So lexer can hilite something only inside math-block. Rules “[“, “]” also set and reset bit0. So lexer hilites words inside “[ ]” blocks, with another style.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:6.95268e-310px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:12pt;"><br /></p>
<p align="center" style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:4.66203e-310px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:12pt;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:4.66203e-310px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:18pt; color:#579d1c;">2) Parent block</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:6.95268e-310px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:18pt; color:#579d1c;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:6.95268e-310px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:12pt;">Options exist for tab “Parser” and tab “Rules”.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:6.95268e-310px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:12pt; font-weight:600;">Option “Parent block”</span><span style=" font-size:12pt;"> - use it, to run rule only when current position lies inside block NN (with opening rule NN to be correct). Maybe also inside some sub-block of this block NN, or block of 2-3-4... level inside NN. </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:6.95268e-310px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:12pt; font-weight:600;">Option “Strict parent block”</span><span style=" font-size:12pt;"> - use it when you need position inside block NN, but not its nested blocks.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:6.95268e-310px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:12pt; font-weight:600;">Option “Not a parent” </span><span style=" font-size:12pt;">- use it when you need position in any blocks, except block NN. You can combine this opt with “Strict parent”.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:6.95268e-310px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:12pt; font-weight:600;">Option “Always enabled”</span><span style=" font-size:12pt;"> - if on, check will be ok also when this lexer is sublexer (of some outer lexer).</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:6.95268e-310px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:12pt; font-weight:600;">Option “Ignore as parent”</span><span style=" font-size:12pt;"> (in “Text range” tab) – helper option for above opts, you can disable some rule for parent detections.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:6.95268e-310px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:12pt;"><br /></p>
<p align="center" style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:4.66203e-310px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:12pt;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:4.66203e-310px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:18pt; color:#579d1c;">3) Same id in opening/closing rule</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:6.95268e-310px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:18pt; color:#579d1c;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:6.95268e-310px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:12pt;">This is needed, when lexer uses folding from e.g. </span><span style=" font-size:12pt; color:#3465a4;">&lt;tagname&gt;</span><span style=" font-size:12pt;"> to </span><span style=" font-size:12pt; color:#3465a4;">&lt;/tagname&gt;</span><span style=" font-size:12pt;"> (HTML) or e.g. from “</span><span style=" font-size:12pt; color:#3465a4;">begin Name</span><span style=" font-size:12pt;">” to “</span><span style=" font-size:12pt; color:#3465a4;">end Name</span><span style=" font-size:12pt;">”. Here you must check, that folding wont fold from </span><span style=" font-size:12pt; color:#3465a4;">&lt;aa&gt;</span><span style=" font-size:12pt;"> to </span><span style=" font-size:12pt; color:#3465a4;">&lt;/ccc&gt;</span><span style=" font-size:12pt;">, wont fold from “</span><span style=" font-size:12pt; color:#3465a4;">begin NameA</span><span style=" font-size:12pt;">” to “</span><span style=" font-size:12pt; color:#3465a4;">end NameB</span><span style=" font-size:12pt;">”. Good lexer must check this in folding. Used in HTML, XML, LaTeX, some others. </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:6.95268e-310px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:12pt;">Opening block has disabled flag </span><span style=" font-size:12pt; font-weight:600;">“Require same indent”</span><span style=" font-size:12pt;">, but closing block must have it checked. Now set, where is Id. Use option </span><span style=" font-size:12pt; font-weight:600;">“Identifier index”</span><span style=" font-size:12pt;"> - here is index of token with Id, in tokens list of “Conditions”. Seems that you should check flag </span><span style=" font-size:12pt; font-weight:600;">“Relative to end of condition”</span><span style=" font-size:12pt;"> too (not sure here), and write negative index – e.g. “-2” means that 3rd item from end of condition list is Id. Must do it for opening+closing rules.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:6.95268e-310px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:12pt;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:6.95268e-310px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:18pt; color:#579d1c;">4) Block offset</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:6.95268e-310px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:18pt; color:#579d1c;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:6.95268e-310px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:12pt;">This option is needed to adjust block (in “Rules” tab) when block works, but result of block hiliting is shifted (to left or right). For ex, rule has N items in Conditions list, and found some range. You set a style “Some BG” for this rule, style hilites block shifted by 2 tokens to right. Use option “-2” to shift block lefter.</span></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:6.95268e-310px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:18pt; color:#579d1c;">5) Regex in Conditions list</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:6.95268e-310px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:18pt; color:#579d1c;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:6.95268e-310px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:12pt;">You can use regex for items in rules (tab “Rules”, sub-tab “Conditions”). Set choice “Condition” to “mask” or “strict mask” and write regex, where you usually write words, in listbox on the right. “Strict mask” means that regex match is entire token (else can be part of token).</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:6.95268e-310px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:12pt;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:6.95268e-310px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:18pt; color:#579d1c;">6) Initially closed (no end rule)</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:6.95268e-310px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:18pt; color:#579d1c;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:6.95268e-310px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:12pt;">This is option for rule in “Text range” tab. Needed for ranges, which you cannot find good. Some C-like lexer needs it: it is easy to find beginning of range (by keyword “func” for ex) but it’s hard to find ending of range (reason is nested “{}” or smth, always thriller for C-like). You set this option, and block still found, but without end, you cannot fold it, but can show it in the Tree panel.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:6.95268e-310px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:12pt;">Of course, such blocks cannot include another blocks, so “function inside function” will be 2 functions on the same level, in the Tree.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:6.95268e-310px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:12pt;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:6.95268e-310px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:18pt; color:#579d1c;">7) Advice for C-like lexers</span></p>
<p align="center" style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:6.95268e-310px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:18pt; color:#579d1c;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:6.95268e-310px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:12pt;">Don't make single token type &quot;Symbol&quot; for all symbols (brackets, punctuations, operators), instead make it like updated Java lexer. Several &quot;token types&quot;:</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:4.66203e-310px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">&quot;Symbol ()&quot; for round brackets</li>
<li style=" font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:4.66203e-310px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">&quot;Symbol {}&quot; for curly brackets</li>
<li style=" font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:4.66203e-310px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">&quot;Symbol&quot; for others</li>
<li style=" font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:4.66203e-310px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">maybe 4th type &quot;Symbol single&quot;. 3rd and 4th types are needed to support &quot;font ligatures&quot;: one rule gets 1+ chars (regex has &quot;+&quot;), another gets single char (regex without &quot;+&quot;).</li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:6.95268e-310px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:12pt;">Types &quot;Symbol ()&quot; and &quot;Symbol {}&quot; are very useful for C-like lexers: in opening rule for &quot;function start&quot; you can skip not all symbols now, but only &quot;Symbol&quot; symbols (so won't skip () and {} brackets). Conditions for rule will be like this: </span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:4.66203e-310px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">token &quot;id&quot; with value “function”</li>
<li style=" font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:4.66203e-310px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">skip tokens &quot;comment&quot;</li>
<li style=" font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:4.66203e-310px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">token &quot;id&quot;</li>
<li style=" font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:4.66203e-310px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">token &quot;symbol ()&quot; with value &quot;(&quot;</li>
<li style=" font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:4.66203e-310px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">skip tokens &quot;id&quot;, &quot;symbol&quot;, &quot;string&quot;, &quot;number&quot;, &quot;comment&quot;</li>
<li style=" font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:4.66203e-310px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">token &quot;symbol ()&quot; with value &quot;)&quot;</li>
<li style=" font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:4.66203e-310px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">skip tokens again</li>
<li style=" font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:4.66203e-310px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">token &quot;symbol {}&quot; with value &quot;{&quot;</li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:4.66203e-310px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:12pt;">Ending rule can have single condition, for token “symbol {}” with value “}”. And ending rule can be used by several opening rules, of course (Java lexer does it).</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:4.66203e-310px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:12pt;"><br /></p></td></tr></table></body></html>